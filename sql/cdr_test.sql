create table cdr(
id int primary key auto_increment,
checkout int,
dispisal int,
success int,
faild int,
rate decimal(4,2),
t_date datetime
) engine = innodb default charset=utf8;

insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-01 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-02 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');
insert into cdr(checkout,dispisal,success,faild,rate,t_date) values (100,80,60,20,0.75,'2018-09-03 08:08:59');




select dayofyear(t_date) td,sum(checkout),sum(disposal),sum(success), sum(faild),sum(rate)/count(rate)
from cdr
group by td;

mysql> select dayofyear(t_date) td, count(t_date),sum(checkout),sum(disposal),sum(success), sum(faild),sum(rate)/count(rate)
    -> from cdr
    -> group by td;
-- +------+---------------+---------------+--------------+------------+-----------------------+
-- | td   | sum(checkout) | sum(disposal) | sum(success) | sum(faild) | sum(rate)/count(rate) |
-- +------+---------------+---------------+--------------+------------+-----------------------+
-- |  244 |          2900 |          2320 |         1740 |        580 |              0.750000 |
-- |  245 |          1700 |          1360 |         1020 |        340 |              0.750000 |
-- |  246 |          2300 |          1840 |         1380 |        460 |              0.750000 |
-- +------+---------------+---------------+--------------+------------+-----------------------+



-- oracle db
create table cd (
uuid varchar2(50) not null,
update_date date ,
break_flag number ,
break_code number
);

-- break_flag = 2 or 4  成功  ，
-- break_code = -1 or -2 or -3 失败,'yyyy-mm-dd HH24:MM:ss)
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy/mm/dd HH24:Mi:ss'),4,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/2 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/2 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/2 10:10:10','yyyy-mm-dd HH24:Mi:ss'),2,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/2 10:10:10','yyyy-mm-dd HH24:Mi:ss'),2,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/2 10:10:10','yyyy-mm-dd HH24:Mi:ss'),2,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/2 10:10:10','yyyy-mm-dd HH24:Mi:ss'),2,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/2 10:10:10','yyyy-mm-dd HH24:Mi:ss'),2,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/2 10:10:10','yyyy-mm-dd HH24:Mi:ss'),2,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/2 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/2 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/2 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/2 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-2);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-2);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-2);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-2);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/3 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-1);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-2);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-2);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-2);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/1 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-2);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/3 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-3);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/3 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-3);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/3 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-3);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/3 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-3);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/3 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-3);
insert into cd (uuid,update_date,break_flag,break_code) values ('111',to_date('2018/10/3 10:10:10','yyyy-mm-dd HH24:Mi:ss'),4,-3);
insert into cd (uuid,update_date,break_code) values ('111',to_date('2018/10/4 10:10:10','yyyy/mm/dd HH24:Mi:ss'),-3);
insert into cd (uuid,update_date,break_code) values ('111',to_date('2018/10/4 10:10:10','yyyy/mm/dd HH24:Mi:ss'),-3);
insert into cd (uuid,update_date,break_code) values ('111',to_date('2018/10/4 10:10:10','yyyy/mm/dd HH24:Mi:ss'),-3);
insert into cd (uuid,update_date,break_code) values ('111',to_date('2018/10/4 10:10:10','yyyy/mm/dd HH24:Mi:ss'),-3);
insert into cd (uuid,update_date,break_code) values ('111',to_date('2018/10/4 10:10:10','yyyy/mm/dd HH24:Mi:ss'),-3);
insert into cd (uuid,update_date,break_flag) values ('111',to_date('2018/10/4 10:10:10','yyyy/mm/dd HH24:Mi:ss'),2);
insert into cd (uuid,update_date,break_flag) values ('111',to_date('2018/10/4 10:10:10','yyyy/mm/dd HH24:Mi:ss'),2);
insert into cd (uuid,update_date,break_flag) values ('111',to_date('2018/10/4 10:10:10','yyyy/mm/dd HH24:Mi:ss'),2);
insert into cd (uuid,update_date,break_flag) values ('111',to_date('2018/10/4 10:10:10','yyyy/mm/dd HH24:Mi:ss'),4);
insert into cd (uuid,update_date,break_flag) values ('111',to_date('2018/10/4 10:10:10','yyyy/mm/dd HH24:Mi:ss'),4);
insert into cd (uuid,update_date,break_flag) values ('111',to_date('2018/10/4 10:10:10','yyyy/mm/dd HH24:Mi:ss'),4);
insert into cd (uuid,update_date,break_flag) values ('111',to_date('2018/10/4 10:10:10','yyyy/mm/dd HH24:Mi:ss'),4);

-- 统计每天的成功的量和失败的量


-- 按天统计
select to_char(t.update_date+15/24, 'YYYY-MM-DD') as 天,count(t.update_date) as 检出量,sum(t.break_flag) as 成功, sum(t.break_code) as 失败
from cd t
WHERE
	t.break_flag = 2 OR t.break_flag = 4
group by to_char(t.update_date+15/24, 'YYYY-MM-DD')
ORDER by 天 NULLS  LAST;
--
-- 天             检出量       成功       失败
-- ---------- ---------- ---------- ----------
-- 2018-10-02         16         64        -24
-- 2018-10-03         12         36        -12
-- 2018-10-04          7         28        -19
-- 2018-10-05         14         44


